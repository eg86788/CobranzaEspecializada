{% extends "base.html" %}
{% block title %}Minutas{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Minutas</h3>
  <a href="{{ url_for('minutas.nueva') }}" class="btn btn-primary">Nueva minuta</a>
</div>

{% if proximos and proximos|length %}
<div class="alert alert-warning">
  <strong>Compromisos próximos (≤ 7 días):</strong>
  <ul class="mb-0">
    {% for c in proximos %}
      <li>
        <strong>{{ c.descripcion }}</strong> — Resp: {{ c.responsable }}
        — ETA: {{ c.eta }} — Minuta: 
        <a href="{{ url_for('minutas.ver', minuta_id=c.minuta_id) }}">{{ c.asunto }}</a>
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Asunto</th>
      <th>Creada</th>
      <th class="text-end">Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>{{ it.fecha_reunion }}</td>
      <td>{{ it.asunto }}</td>
      <td>{{ it.created_at.strftime('%Y-%m-%d %H:%M') if it.created_at else '' }}</td>
      <td class="text-end">
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('minutas.ver', minuta_id=it.id) }}">Ver</a>
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('minutas.editar', minuta_id=it.id) }}">Editar</a>
        <a class="btn btn-sm btn-outline-info" href="{{ url_for('minutas.pdf', minuta_id=it.id) }}" target="_blank">PDF</a>
        <form class="d-inline" method="post" action="{{ url_for('minutas.eliminar', minuta_id=it.id) }}" onsubmit="return confirm('¿Eliminar la minuta?');">
          <button class="btn btn-sm btn-outline-danger">Eliminar</button>
        </form>
      </td>
    </tr>
  {% else %}
    <tr><td colspan="4" class="text-muted">Sin registros</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
