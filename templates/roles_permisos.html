{% extends "base.html" %}
{% block title %}Roles y permisos{% endblock %}

{% block content %}
<style>
  .perm-card { border:0; border-radius:14px; box-shadow:0 8px 20px rgba(0,0,0,.06); }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">Roles & Permisos</h1>
    <small class="text-muted">Asigna permisos a cada rol del sistema</small>
  </div>
  <a href="{{ url_for('users_admin.listar_usuarios') }}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left me-1"></i> Volver a usuarios
  </a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for cat, msg in messages %}
      <div class="alert alert-{{ 'danger' if cat in ['error','danger'] else cat }} alert-dismissible fade show" role="alert">
        {{ msg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="POST" class="card perm-card">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Rol</label>
        <select class="form-select" name="role_id" onchange="this.form.submit()">
          {% for r in roles %}
            <option value="{{ r }}" {% if selected_role == r %}selected{% endif %}>{{ r }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Selecciona el rol a configurar.</div>
      </div>

      <div class="col-md-8">
        <label class="form-label">Permisos</label>
        <div class="row g-2">
          {% for p in permisos %}
            <div class="col-sm-6">
              <label class="form-check">
                <input class="form-check-input" type="checkbox" name="permisos" value="{{ p.code }}"
                  {% if role_perm_codes and (p.code in role_perm_codes) %}checked{% endif %}>
                <span class="form-check-label">
                  <strong>{{ p.code }}</strong><br>
                  <small class="text-muted">{{ p.descripcion }}</small>
                </span>
              </label>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <div class="card-footer bg-white d-flex justify-content-end">
    <button type="submit" class="btn btn-primary">
      <i class="bi bi-save2 me-1"></i> Guardar cambios
    </button>
  </div>
</form>
{% endblock %}
