<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Solicitud SEF{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='custom.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    :root{
      --topbar-height: 28px;     /* barra negra */
      --nav-height: 64px;        /* barra azul */
      --steps-height: 56px;      /* barra de pasos */
      --footer-height: 56px;     /* altura visual del footer fijo */
    }

    html, body { margin: 0; padding: 0; }

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Padding cuando hay barras y/o pasos */
    body.has-bars { padding-top: calc(var(--topbar-height) + var(--nav-height)); }
    body.has-bars.has-steps { padding-top: calc(var(--topbar-height) + var(--nav-height) + var(--steps-height)); }

    /* 游녤 Reservamos espacio para que el footer fijo no tape el contenido */
    body.has-footer { padding-bottom: var(--footer-height); }

    .barra-negra{
      background:#000; color:#fff; font-size:.5rem;
      position:fixed; top:0; left:0; right:0; height:var(--topbar-height);
      z-index:1040; display:flex; justify-content:flex-end; align-items:center;
      padding:0 1rem; font-weight:500;
    }

    .nav-bx{
      background:#003746; border-bottom:3px solid #FF1B44;
      position:fixed; top:var(--topbar-height); left:0; width:100%; z-index:1035;
      box-shadow:0 2px 6px rgba(0,0,0,.1); padding:.2rem 0;
    }
    .nav-bx .nav-link{ color:#fff!important; font-weight:500; padding:.5rem 1rem; }
    .nav-bx .nav-link.active{ border-bottom:3px solid #FF1B44; color:#fff!important; border-radius:0; }

    .brand-wrap{ display:flex; align-items:center; gap:.75rem; }
    .brand-wrap img{ height:28px; width:auto; display:block; }
    .brand-divider{ width:1px; height:24px; background:rgba(255,255,255,.35); }
    .brand-title{ color:#fff; font-weight:600; white-space:nowrap; }

    .dropdown{ position:relative; z-index:1036; }
    .dropdown-menu-custom{
      background:#fff; border:none; border-radius:24px; box-shadow:0 10px 25px rgba(0,0,0,.15);
      padding:1rem; min-width:260px; margin-top:.5rem; position:absolute; top:100%; left:50%!important;
      transform:translateX(-50%) translateY(-10px) scale(.95); opacity:0; visibility:hidden; pointer-events:none;
      transition:all .3s ease; z-index:1037;
    }
    .dropdown-menu-custom.show{ opacity:1; visibility:visible; transform:translateX(-50%) translateY(0) scale(1); pointer-events:auto; }
    .dropdown-menu-custom::before{
      content:""; position:absolute; top:-10px; left:50%; transform:translateX(-50%);
      border-left:10px solid transparent; border-right:10px solid transparent; border-bottom:10px solid #fff;
    }
    .dropdown-menu-custom a{ display:block; padding:.5rem 1rem; color:#003746; font-weight:500; text-decoration:none; }
    .dropdown-menu-custom a:hover{ background:#DAE9EE; border-radius:8px; }

    /* Barra de pasos pegada al borde inferior de la barra azul */
    .nav-steps{
      position:fixed;
      top:calc(var(--topbar-height) + var(--nav-height));
      left:0; width:100%; z-index:1034;
      background:#f8f9fa; border-bottom:1px solid #dee2e6;
      height:var(--steps-height); display:flex; align-items:center;
      box-shadow:0 2px 6px rgba(0,0,0,.10);
    }
    .nav-steps .step-container{ width:100%; padding:0 .75rem; display:flex; justify-content:space-between; align-items:center; }

    /* 游녤 Footer fijo al fondo, visible sin scroll */
    footer.footer{
      position:fixed;
      left:0; right:0; bottom:0;
      z-index:1030;

      height:var(--footer-height);
      display:flex; align-items:center; justify-content:space-between;

      background:#003746; color:#fff; font-size:.9rem;
      padding:0 .75rem; /* vertical queda controlado por height */
      box-shadow:0 -2px 6px rgba(0,0,0,.08);
    }
    footer.footer img{ height:28px; }

    main.container{ flex:1; }
  </style>
</head>

<!-- a침adimos 'has-footer' cuando NO imprimimos PDF -->
<body class="{% if not imprimir_pdf %}has-bars{% if paso_actual is defined %} has-steps{% endif %} has-footer{% endif %}">

  {% if not imprimir_pdf %}
  <!-- Barra negra (fecha) -->
  <div class="barra-negra">
    <span id="fecha_actual"></span>
  </div>

  <!-- Barra azul (nav) -->
  <nav class="navbar navbar-expand-lg nav-bx">
    <div class="container-fluid justify-content-between">
      <!-- IZQ: Logotipo | T칤tulo -->
      <div class="brand-wrap">
        <img src="{{ url_for('static', filename='banamex_azu.png') }}" alt="Banamex">
        <div class="brand-divider"></div>
        <span class="brand-title">Cobranza Especializada</span>
      </div>

      <!-- CENTRO-DER: Men칰s -->
      <div class="d-flex align-items-center">
        {% if session.get('role') == 'admin' %}
        <div class="dropdown me-3">
          <a class="nav-link dropdown-toggle active" href="#" id="menuAdmin">Administraci칩n</a>
          <div class="dropdown-menu dropdown-menu-custom" aria-labelledby="menuAdmin">
            <a href="{{ url_for('admin_portal.dashboard') }}">Panel admin</a>
            <a href="{{ url_for('catalogos.ver_catalogos') }}">Cat치logos</a>
            <a href="{{ url_for('templates_admin.list_templates') }}">Plantillas</a>
            <a href="{{ url_for('adh_admin.list_adh') }}">Contratos de adhesi칩n</a>
            <hr class="dropdown-divider">
            <a href="{{ url_for('users_admin.listar_usuarios') }}">Usuarios</a>
            <a href="{{ url_for('users_admin.roles_permisos') }}">Roles & Permisos</a>
          </div>
        </div>
        {% endif %}
      </div>

      {# DERECHA: Usuario (Login / Logout) #}
      {% set role = session.get('role') %}
      {% set username = session.get('username') or current_user_name %}
      <div class="d-flex align-items-center">
        {% if role %}
          {% if username %}
            <span class="text-white me-3">{{ current_user_name }}</span>
          {% endif %}
          <a class="btn btn-sm btn-light" href="{{ url_for('auth_admin.logout') }}">Salir</a>
        {% else %}
          <a class="btn btn-sm btn-outline-light" href="{{ url_for('auth_admin.login') }}">Entrar</a>
        {% endif %}
      </div>
    </div>
  </nav>

  {% if paso_actual is defined %}
  <!-- Barra de pasos pegada al borde inferior -->
  <div class="nav-steps">
    <div class="step-container">
      {% set pasos = [('1', 'Datos Generales'), ('2', 'Unidades de Negocio'), ('3', 'Cuentas'), ('4', 'Usuarios SEF'), ('5', 'Contactos'), ('6', 'Finalizaci칩n')] %}
      {% for num, label in pasos %}
        <div class="text-center flex-fill">
          <div class="rounded-circle mx-auto d-flex justify-content-center align-items-center"
               style="width:32px;height:32px;background-color:{% if paso_actual == num|int %}#FF1B44{% elif paso_actual > num|int %}#003746{% else %}#ccc{% endif %};color:#fff;font-weight:bold;">
            {{ num }}
          </div>
          <small class="d-block mt-1" style="font-size:0.75rem;color:#123;">{{ label }}</small>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
  {% endif %}

  <main class="container mt-4">
    <div class="pb-5">
      {% block content %}{% endblock %}
    </div>
  </main>

  {% if not imprimir_pdf %}
  <footer class="footer">
    <div>
      <img src="{{ url_for('static', filename='banamex_roseta.png') }}" alt="Roseta Banamex">
    </div>
    <div class="text-end flex-fill">
      Banamex empieza contigo.
    </div>
  </footer>
  {% endif %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.8/dist/inputmask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function wireDropdown(toggleId) {
        const toggle = document.getElementById(toggleId);
        if (!toggle) return;
        const menu = document.querySelector(`.dropdown-menu-custom[aria-labelledby="${toggleId}"]`);
        if (!menu) return;
        const dropdown = toggle.closest('.dropdown');
        toggle.addEventListener('click', (e) => { e.preventDefault(); menu.classList.toggle('show'); });
        document.addEventListener('click', (e) => { if (!dropdown.contains(e.target)) menu.classList.remove('show'); });
      }
      wireDropdown('menuProductos');
      wireDropdown('menuAdmin');

      const fechaElemento = document.getElementById("fecha_actual");
      if (fechaElemento) {
        const dias = ['DOMINGO','LUNES','MARTES','MI칄RCOLES','JUEVES','VIERNES','S츼BADO'];
        const meses = ['ENERO','FEBRERO','MARZO','ABRIL','MAYO','JUNIO','JULIO','AGOSTO','SEPTIEMBRE','OCTUBRE','NOVIEMBRE','DICIEMBRE'];
        const hoy = new Date();
        fechaElemento.textContent = `${dias[hoy.getDay()]}, ${hoy.getDate()} DE ${meses[hoy.getMonth()]} DE ${hoy.getFullYear()}.`;
      }

      document.querySelectorAll('form, input, textarea, select').forEach(el => { el.setAttribute('autocomplete', 'off'); });
      Inputmask({"mask": "(999) 9999999"}).mask(document.querySelectorAll('input[type="tel"], .telefono'));
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
