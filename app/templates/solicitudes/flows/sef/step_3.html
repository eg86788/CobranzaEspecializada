{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h4 class="mb-3">
        Servicios de Efectivo
        <small class="text-muted">– Unidades de Negocio </small>
      </h4>

  <!-- ===================== FORMULARIO NUEVA UNIDAD ===================== -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <strong>Agregar nueva Unidad</strong>
    </div>
    <div class="card-body">

      <form method="POST">

        <div class="row g-3">

          <div class="col-md-4">
            <label class="form-label">Acción</label>
            <select name="accion_unidad" class="form-select" required>
              <option value="">Selecciona...</option>
              <option value="ALTA">ALTA</option>
              <option value="MODIFICACION">MODIFICACIÓN</option>
              <option value="BAJA">BAJA</option>
            </select>
          </div>

          <div class="col-md-8">
            <label class="form-label">Nombre Unidad</label>
            <input type="text" name="nombre_unidad" class="form-control" required>
          </div>

          <div class="col-md-4">
            <label class="form-label">CPAE</label>
            <input type="text" name="cpae_unidad" class="form-control">
          </div>

          <div class="col-md-4">
            <label class="form-label">ETV</label>
            <input type="text" name="etv_unidad" class="form-control">
          </div>

          <div class="col-md-4">
            <label class="form-label">Procesadora</label>
            <input type="text" name="procesadora_unidad" class="form-control">
          </div>

        </div>

        <hr class="my-4">

        <h6>Servicios</h6>

        <div class="row g-3">

          <div class="col-md-4 form-check">
            <input class="form-check-input" type="checkbox" name="servicio_verificacion_tradicional">
            <label class="form-check-label">Depósito Tradicional</label>
          </div>

          <div class="col-md-4 form-check">
            <input class="form-check-input" type="checkbox" name="servicio_verificacion_electronica">
            <label class="form-check-label">Depósito Electrónico</label>
          </div>

          <div class="col-md-4 form-check">
            <input class="form-check-input" type="checkbox" name="servicio_dotacion">
            <label class="form-check-label">Dotación Electrónica</label>
          </div>

          <div class="col-md-4 form-check">
            <input class="form-check-input" type="checkbox" name="servicio_traslado">
            <label class="form-check-label">Traslado de Valores</label>
          </div>

          <div class="col-md-4 form-check">
            <input class="form-check-input" type="checkbox" name="servicio_cofre">
            <label class="form-check-label">Renta de Cofre</label>
          </div>

        </div>

        <hr class="my-4">

        <h6>Domicilio</h6>

        <div class="row g-3">

          <div class="col-md-6">
            <label class="form-label">Calle y Número</label>
            <input type="text" name="calle_numero" class="form-control">
          </div>

          <div class="col-md-3">
            <label class="form-label">Municipio</label>
            <input type="text" name="municipio" class="form-control">
          </div>

          <div class="col-md-3">
            <label class="form-label">Entidad Federativa</label>
            <input type="text" name="entidad_federativa" class="form-control">
          </div>

          <div class="col-md-3">
            <label class="form-label">Código Postal</label>
            <input type="text" name="codigo_postal" class="form-control">
          </div>

        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-primary btn-sm">
            Guardar Unidad
          </button>
        </div>

      </form>

    </div>
  </div>

  <!-- ===================== LISTADO DE UNIDADES ===================== -->

  <div class="card">
    <div class="card-header bg-light">
      <strong>Unidades capturadas</strong>
    </div>
    <div class="card-body p-0">

      {% if solicitud.sef and solicitud.sef.unidades %}
        <div class="table-responsive">
          <table class="table table-sm table-striped mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Acción</th>
                <th>Nombre</th>
                <th>CPAE</th>
                <th>ETV</th>
              </tr>
            </thead>
            <tbody>
              {% for u in solicitud.sef.unidades %}
              <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.accion_unidad }}</td>
                <td>{{ u.nombre_unidad }}</td>
                <td>{{ u.cpae_unidad }}</td>
                <td>{{ u.etv_unidad }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="p-3 text-muted">
          No hay unidades registradas.
        </div>
      {% endif %}

    </div>
  </div>

  <!-- ===================== NAVEGACIÓN ===================== -->

  <div class="mt-4 d-flex justify-content-between">
    <a href="{{ url_for('solicitudes_flow.step', solicitud_id=solicitud.id, step=2) }}"
       class="btn btn-outline-secondary btn-sm">
      ← Regresar
    </a>

    <a href="{{ url_for('solicitudes_flow.step', solicitud_id=solicitud.id, step=4) }}"
       class="btn btn-success btn-sm">
      Continuar →
    </a>
  </div>

</div>

{% endblock %}
