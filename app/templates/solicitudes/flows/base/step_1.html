{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <h3>Solicitud #{{ solicitud.id }}</h3>
  <p class="text-muted">Producto: {{ solicitud.producto }}</p>

  <form method="POST" class="mt-4 needs-validation" novalidate>

    <!-- ========================= -->
    <!-- DATOS DEL CLIENTE -->
    <!-- ========================= -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-light">
        <strong>Datos del Cliente</strong>
      </div>
      <div class="card-body">

        <div class="row g-3">

          <!-- NUMERO CLIENTE -->
          <div class="col-md-6">
            <label class="form-label">Número Cliente</label>
            <input type="text"
                   name="numero_cliente"
                   class="form-control"
                   data-type="numero_cliente"
                   inputmode="numeric"
                   maxlength="10"
                   pattern="\d{10}"
                   required
                   value="{{ solicitud.numero_cliente or '' }}">
            <div class="invalid-feedback">
              Debe contener exactamente 10 dígitos numéricos.
            </div>
          </div>

          <!-- NUMERO CONTRATO -->
          <div class="col-md-6">
            <label class="form-label">Número Contrato</label>
            <input type="text"
                   name="numero_contrato"
                   class="form-control"
                   data-type="numero_contrato"
                   inputmode="numeric"
                   maxlength="12"
                   pattern="\d{12}"
                   required
                   value="{{ solicitud.numero_contrato or '' }}">
            <div class="invalid-feedback">
              Debe contener exactamente 12 dígitos numéricos.
            </div>
          </div>

          <!-- RAZON SOCIAL -->
          <div class="col-md-8">
            <label class="form-label">Razón Social</label>
            <input type="text"
                   name="razon_social"
                   class="form-control"
                   required
                   value="{{ solicitud.razon_social or '' }}">
            <div class="invalid-feedback">
              Campo obligatorio.
            </div>
          </div>

          <!-- RFC -->
          <div class="col-md-4">
            <label class="form-label">RFC</label>
            <input type="text"
                   name="rfc"
                   class="form-control"
                   data-type="text"
                   maxlength="13"
                   pattern="^([A-ZÑ&]{3,4})\d{6}[A-Z0-9]{3}$"
                   required
                   value="{{ solicitud.rfc or '' }}">
            <div class="invalid-feedback">
              Formato inválido. Ejemplo: ABCD123456XYZ
            </div>
          </div>

        </div>

      </div>
    </div>

    <!-- ========================= -->
    <!-- INFORMACIÓN DEL TRÁMITE -->
    <!-- ========================= -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-light">
        <strong>Información del Trámite</strong>
      </div>
      <div class="card-body">

        <div class="row g-3">

          <!-- TIPO TRAMITE -->
          <div class="col-md-6">
            <label class="form-label">Tipo de Trámite</label>
            <select name="tipo_tramite"
                    class="form-select"
                    required>
              <option value="">Seleccione...</option>
              <option value="ALTA"
                {% if solicitud.tipo_tramite == "ALTA" %}selected{% endif %}>
                ALTA
              </option>
              <option value="MODIFICACION"
                {% if solicitud.tipo_tramite == "MODIFICACION" %}selected{% endif %}>
                MODIFICACIÓN
              </option>
              <option value="BAJA"
                {% if solicitud.tipo_tramite == "BAJA" %}selected{% endif %}>
                BAJA
              </option>
            </select>
            <div class="invalid-feedback">
              Debe seleccionar un tipo de trámite.
            </div>
          </div>

          <!-- OBSERVACIONES -->
          <div class="col-md-12">
            <label class="form-label">Observaciones</label>
            <textarea name="observaciones"
                      rows="3"
                      class="form-control">{{ solicitud.observaciones or '' }}</textarea>
          </div>

        </div>

      </div>
    </div>

    <!-- BOTON -->
    <div class="d-flex justify-content-end">
      <button type="submit" class="btn btn-primary px-4">
        Guardar y continuar →
      </button>
    </div>

  </form>

</div>

<script>
// Bootstrap validation
(() => {
  'use strict'
  const forms = document.querySelectorAll('.needs-validation')

  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      form.classList.add('was-validated')
    }, false)
  })
})();
</script>

{% endblock %}
